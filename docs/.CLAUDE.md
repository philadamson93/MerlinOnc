# Merlin - Claude Code Project Guide

## Claude Code Instructions

- Do not add "Co-Authored-By: Claude" to commit messages

## Project Overview

**Merlin** is a Vision-Language Foundation Model for 3D CT imaging from Stanford MIMI Lab.

- **Package:** `merlin-vlm` (v0.0.6)
- **Python:** 3.9+ (3.10 recommended)
- **License:** MIT
- **Paper:** arXiv:2406.06512

## Key Capabilities

1. Image/Text contrastive embeddings
2. Image-only embeddings (2,048-dim)
3. Phenotype classification (1,692 classes)
4. Five-year disease prediction (6 outcomes)
5. Radiology report generation
6. **MerlinOnc** - Oncology-specific model variant

## Directory Structure

```
MerlinOnc/
├── merlin/
│   ├── models/          # ML architecture (load.py, build.py, i3res.py)
│   ├── data/            # Data processing (dataloaders.py, monai_transforms.py)
│   └── utils/           # Utilities
├── documentation/       # Usage docs and demos
├── docs/                # Claude Code documentation
└── pyproject.toml
```

## Documentation Index

- [Dataloading](./dataloading.md) - CT data loading and preprocessing
- [Models](./models.md) - Model registry and architecture
- [Inference](./inference.md) - Running predictions
- [Development](./development.md) - Setup, testing, contributing

## Quick Reference

| Task | File |
|------|------|
| Load model | `merlin/models/load.py` |
| Model architecture | `merlin/models/build.py` |
| 3D ResNet | `merlin/models/i3res.py` |
| Data transforms | `merlin/data/monai_transforms.py` |
| DataLoader | `merlin/data/dataloaders.py` |
| Phenotype labels | `documentation/phenotypes.csv` |

## Quick Usage

```python
from merlin import Merlin

# Default model
model = Merlin()

# MerlinOnc (oncology-specific)
model = Merlin(MerlinOnc=True)

# Use local weights (skip HuggingFace download)
model = Merlin(MerlinOnc=True, local_checkpoint_path="/path/to/weights.pt")

# Combine with output modes
model = Merlin(MerlinOnc=True, ImageEmbedding=True)
```
